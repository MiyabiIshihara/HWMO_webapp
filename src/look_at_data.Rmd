---
title: "basic"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(tidyverse)
```

`sf` Resources:
<https://ryanpeek.github.io/mapping_in_R/index.html>
<https://edzer.github.io/rstudio_conf/#1>

```{r load hazard assessment data}
# Load data
haz_dat = st_read("../data/WHA Metadata/WHA2015.shp")
# Check coordinate reference system
st_crs(haz_dat)
# Plot
plot(st_geometry(haz_dat), col="white")
# View data
View(haz_dat)
```

`tidycensus`:
<https://walkerke.github.io/tidycensus/articles/basic-usage.html>

```{r load census data}
# Load HWMO data
census_dat = st_read("../data/Census_Tract_All_Data/Census_Tract_All_Data.shp")
# Check coordinate reference system
st_crs(census_dat)
# Plot
plot(st_geometry(census_dat), col="white")
# View data
View(census_dat)
head(census_dat)

# Load any other census data
library(tidycensus)
# library(USAboundaries)
census_api_key("49ee7d5aa193a489b9db1395a624d2813b9b4d5c")
# get particular data
m90 <- get_decennial(geography = "state", variables = "H043A001", year = 1990)
vt <- get_acs(geography = "county", 
              variables = c(medincome = "B19013_001"), 
              state = "VT")
# Look at all variables
v15 <- load_variables(2016, "acs5", cache = TRUE)

View(v15)


```

HWMO-given census variables:
- Bachelors Degree or Higher: BD_Higher
- Homeownership Rate: Homeowner
- Median Household Income: MedH_Inc
- Native Hawaiian alone or in combination with another race: NH_ac
- Native Hawaiian and Other Pacific Islanders alone or in combination with another race: NH_PI_ac
- Other Pacific Islanders alone or in combination with another race: PI_a 
Other variables to consider: <https://www.epa.gov/ejscreen/overview-demographic-indicators-ejscreen>

```{r load fire history data}
# Load data
fire_dat = st_read("../data/Fire History/HI_Wildfires1.shp")
# Check coordinate reference system
st_crs(fire_dat)
# Plot
fire_dat %>%
  filter(Long < -50) %>%
  ggplot() + 
  geom_point(aes(x= Long, y = Lat))
# View data
View(fire_dat)
```

```{r load community input data}
# Load data
comm_input_dat <-
    # this generates the list of files
    list.files(path = "../data/community_input/",
               pattern="*.csv", 
               full.names = T) %>% 
    # map over read_csv, col_types specifies that each have same column headers
    map_dfr(~read_csv(., col_types = cols(.default = "c"))) 
```

```{r clean community input data}
## split secondary desc (should be 15 total)
comm_input_dat <- comm_input_dat %>%
    mutate(
      # combines firewise and Firewise
      secondary_desc = tolower(secondary_desc),
      # combines collab and Collab
      key_codes = tolower(key_codes)
           ) %>%
    separate(secondary_desc, c("sec_desc1", "sec_desc2", "sec_desc3"), ",")

# Remove potentially complicating $ and '
comm_input_dat$sec_desc1<-gsub("\\$", "money", comm_input_dat$sec_desc1)
comm_input_dat$sec_desc1<-gsub("\\'", "", comm_input_dat$sec_desc1)
# Remove all items after - (e.g. to- ll)
comm_input_dat$sec_desc1<-gsub("\\-.*", "", comm_input_dat$sec_desc1)

# Manipulate data
comm_input_dat <- comm_input_dat %>% 
  mutate(total_votes = as.numeric(total_votes)) %>%
  mutate_if(is.character,funs(factor(.))) %>%
  mutate(concern = as.character(concern),
         recommendations = as.character(recommendations))
```









